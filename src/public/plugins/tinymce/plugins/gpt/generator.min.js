var eventSource;$((function(){$('[name="topic"]').focus(),$(document).on("click",'button[type="submit"]',(function(t){t.preventDefault(),$.ajax({url:gpt.route,type:"post",data:$("form").serialize(),success:function(t){!1===t.success?($("#gpt-compose").html(t.html),$('[name="topic"]').focus()):($("#form, #buttons").hide(),$("#content, #stop").show(),$("#gpt-result").html(""),(eventSource=new EventSource(gpt.stream+"?id="+t.id)).onmessage=function(t){if("[DONE]"==t.data)$("#stop").hide(),$("#buttons").show(),eventSource.close();else{let e=JSON.parse(t.data).choices[0].delta.content;void 0!==e&&$("#gpt-result").append(e.replace(/(?:\r\n|\r|\n)/g,"<br>"))}})},error:function(){$("#disable, #loading").hide(),$("#gpt-form").append('<div class="alert alert-danger" id="gpterror">gpt.error</div>')}})})),$(document).on("click","#stop",(function(){$("#stop").hide(),$("#buttons").show(),eventSource.close()})),$(document).on("click","#undo",(function(){$("#form").show(),$("#disable, #loading, #content").hide()})),$(document).on("click","#close",(function(){window.parent.tinyMCE.activeEditor.windowManager.close()})),$(document).on("click","#confirm",(function(){window.parent.postMessage({mceAction:"confirmGPTContent",content:$("#gpt-result").html()},"*")}))}));
